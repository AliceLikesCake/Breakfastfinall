@model BreakfastOrderSystem.Site.Models.ViewModels.ReportVm

@{
    ViewBag.Title = "Index";
}

<h2 class="fw-bold mt-2 ">營業概況</h2>
<div class="container mt-4">
    <div class="header">
        <div class="date-range d-flex align-items-center">
            <!-- 開始日期 -->
            <div class="d-flex align-items-center me-2">
                <label for="startDate" class="mb-0 me-1" style="margin-right: 0.5rem;">開始日期: </label>
                <input type="date" id="startDate" class="form-control" aria-label="Start Date" style="flex: 1;">
            </div>

            <!-- 結束日期 -->
            <div class="d-flex align-items-center me-2">
                <label for="endDate" class="mb-0 me-1" style="margin-right: 0.5rem;">結束日期: </label>
                <input type="date" id="endDate" class="form-control" aria-label="End Date" style="flex: 1;">
            </div>
            <button class="custom-btn" type="button" id="searchButton">搜尋</button>
        </div>
    </div>
    <div class="stats">
        <div class="stat-item">
            <i class="fa-solid fa-sack-dollar"></i>
            <p>總營業額</p>
            <h3 id="totalSales">$0</h3> <!-- 總營業額 -->
        </div>
        <div class="stat-item">
            <i class="fa-solid fa-receipt"></i>
            <p>總訂單數</p>
            <h3 id="totalOrders">0</h3> <!-- 總訂單數 -->
        </div>
        <div class="stat-item">
            <i class="fa-solid fa-user-large"></i>
            <p>訂購會員數</p>
            <h3 id="totalMembers">0</h3> <!-- 訂購會員數 -->
        </div>
    </div>
</div>

<style>

    /*****************************************按扭樣式******************************************/
    /* 通用按鈕樣式 */
    .custom-btn {
        display: inline-block;
        padding: 8px 15px;
        border-radius: 5px;
        text-decoration: none;
        font-size: 14px;
        font-weight: bold;
        color: white;
        margin-right: 10px;
        cursor: pointer;
        transition: background-color 0.3s ease, transform 0.2s ease;
        /*display: inline-flex;*/ /* 讓圖標和文字水平對齊 */
        align-items: center; /* 讓文字居中對齊 */
        justify-content: center; /* 讓文字在按鈕中間水平居中 */
    }


        /* 懸停效果 */
        .custom-btn:hover {
            background-color: #499e73; /* 懸停時使用更深的綠色 */
            transform: translateY(-2px); /* 懸停時按鈕輕微上移 */
        }

    #searchButton {
        background-color: #f1f1f1; /* 使用綠色作為背景色 */
        color: dimgrey; /* 文字顏色為白色 */
        border: #74C69D; /* 使用深綠色作為邊框 */
    }
</style>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // 頁面加載時立即抓取數據
        fetchReportData();

        // 綁定搜尋按鈕的點擊事件
        document.getElementById('searchButton').addEventListener('click', function () {
            fetchReportData();
        });
    });

    function fetchReportData() {
        // 取得開始日期和結束日期的值
        var startDate = document.getElementById('startDate').value;
        var endDate = document.getElementById('endDate').value;

        // 構建查詢參數
        var query = `?startDate=${startDate}&endDate=${endDate}`;

        // 發送 AJAX 請求到後端
        fetch('@Url.Action("GetReportData", "Report")' + query)
            .then(response => response.json())
            .then(data => {
                // 更新頁面中的數據
                document.getElementById('totalSales').textContent = Math.round(data.TotalSales).toLocaleString('zh-TW', {
                    style: 'currency',
                    currency: 'TWD',
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 0
                });
                document.getElementById('totalOrders').textContent = data.TotalOrders;
                document.getElementById('totalMembers').textContent = data.TotalMembers;
            })
            .catch(error => console.error('Error fetching report data:', error));
    }
</script>

<style>
    /* 與之前的CSS相同 */
    .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-bottom: 10px;
        margin-bottom: 20px;
    }

    .date-range input {
        margin: 0 5px;
        padding: 5px;
        border: 1px solid #ccc;
        border-radius: 4px;
    }

    .date-range button {
        padding: 6px 12px;
        background-color: #e6e6e6;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        color: #A2A2A2 !important;
    }

    .stats {
        display: flex;
        justify-content: space-between;
        padding: 18px;
        background-color: #f1f1f1;
        border-radius: 10px;
        height: 300px;
    }

    .stat-item {
        flex: 1;
        text-align: center;
        padding: 50px 20px;
        border-radius: 10px;
        margin: 0 22px;
        background-color: #ffffff;
    }

        .stat-item p::after {
            content: "";
            display: block;
            width: 50%;
            height: 3px;
            background-color: #ddd;
            margin: 10px auto;
        }

        .stat-item i {
            font-size: 56px;
            margin-bottom: 10px;
        }

    /*.stat-item h3 {
            margin: 0;
            font-size: 24px;
            color: #333;
        }*/

    #totalSales {
        font-size: 36px;
        color: #f0ad4e;
        font-weight: bolder
    }

    #totalOrders {
        font-size: 36px;
        color: #81B9CF;
        font-weight: bolder
    }

    #totalMembers {
        font-size: 36px;
        color: #98D1B3;
        font-weight: bolder
    }

    .stat-item p {
        margin: 0;
        font-size: 16px;
        color: #777;
    }

    .fa-sack-dollar {
        color: #f0ad4e;
    }

    .fa-receipt {
        color: #81B9CF;
    }

    .fa-user-large {
        color: #98D1B3;
    }
</style>
